# Todo Voca - 최종 개발 기획서

------

## 📋 목차

1. [서비스 개요](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#1-서비스-개요)
2. [사용자 정의](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#2-사용자-정의)
3. [데이터베이스 설계](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#3-데이터베이스-설계)
4. [핵심 기능 명세](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#4-핵심-기능-명세)
5. [화면별 상세 스펙](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#5-화면별-상세-스펉)
6. [주요 로직 설명](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#6-주요-로직-설명)
7. [기술 스택](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#7-기술-스택)
8. [개발 로드맵](https://claude.ai/chat/61dcded6-0bc8-4d2f-8565-0ec58404a275#8-개발-로드맵)

------

## 1. 서비스 개요

### 1.1 프로젝트명

**Todo Voca (체크리스트 단어장)**

### 1.2 핵심 컨셉

> "단어 암기를 할 일(To-Do) 프로젝트로 관리하는 B2B 학원 관리 플랫폼"

### 1.3 문제 정의

- 학원 강사는 학생들의 단어 암기 진도를 실시간으로 파악하기 어려움
- 기존 단어장 앱은 개인 학습 중심으로 강사-학생 간 관리 기능 부재
- 수기 시험 출제 및 채점에 많은 시간 소요

### 1.4 해결 방안

- **학생**: 순차적 단어 학습 + 완료 단어 시각화 + 자동 온라인 평가
- **강사**: 실시간 진도 모니터링 + Skip 통계 + 클릭 한 번으로 시험 출제

### 1.5 핵심 차별점

```
1. 할 일 목록 UX: 단어를 체크리스트처럼 하나씩 완료
2. 투트랙 평가: 온라인 자동 평가 + 오프라인 강사 평가
3. 점진적 학습 개입: Skip 횟수에 따라 다른 정보 제공
4. 단어장 중심 관리: 반이 아닌 단어장 기준 통계
```

------

## 2. 사용자 정의

### 2.1 사용자 타입

| 역할               | 설명           | 주요 기능                                        |
| ------------------ | -------------- | ------------------------------------------------ |
| **강사 (Teacher)** | 학원 영어 강사 | 학생 관리, 단어장 배정, 진도 모니터링, 시험 출제 |
| **학생 (Student)** | 단어 학습자    | 단어 학습, 온라인 평가 응시, 진도 확인           |

### 2.2 사용자 관계도

```
강사 (1) ━━━ 관리 ━━━ (N) 학생
                      ↓
단어장 (M) ━━━ 배정 ━━━ (N) 학생
```

------

## 3. 데이터베이스 설계

### 3.1 ERD 구조

```
users ━━━ 1:N ━━━ student_wordlists ━━━ N:1 ━━━ wordlists
  │                      │                        │
  │                      └──── N:1 ────┐          │
  │                                    │          │
  └──── 1:N ──── student_word_progress │          │
                         │             │          │
                         N:1           │          │
                         │             │          │
                     words ────────────┴──── N:1 ─┘
                         │
                         1:N
                         │
              completed_wordlists
                         │
                    ┌────┴────┐
                    │         │
              online_tests  offline_tests
```

### 3.2 테이블 상세

#### 3.2.1 users (사용자)

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(20) CHECK (role IN ('teacher', 'student')),
    name VARCHAR(100) NOT NULL,
    daily_goal INT DEFAULT 50,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
```

#### 3.2.2 wordlists (단어장 마스터)

```sql
CREATE TABLE wordlists (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    total_words INT NOT NULL,
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_wordlists_created_by ON wordlists(created_by);
```

#### 3.2.3 words (단어 마스터)

```sql
CREATE TABLE words (
    id SERIAL PRIMARY KEY,
    wordlist_id UUID REFERENCES wordlists(id) ON DELETE CASCADE,
    word_text VARCHAR(100) NOT NULL,
    meaning TEXT NOT NULL,
    example TEXT,
    example_translation TEXT,
    mnemonic TEXT,
    audio_url TEXT,
    sequence_order INT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(wordlist_id, sequence_order)
);

-- 인덱스
CREATE INDEX idx_words_wordlist ON words(wordlist_id);
CREATE INDEX idx_words_sequence ON words(wordlist_id, sequence_order);
```

#### 3.2.4 student_wordlists (학생-단어장 배정)

```sql
CREATE TABLE student_wordlists (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    wordlist_id UUID REFERENCES wordlists(id) ON DELETE CASCADE,
    assigned_by UUID REFERENCES users(id),
    assigned_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(student_id, wordlist_id)
);

-- 인덱스
CREATE INDEX idx_student_wordlists_student ON student_wordlists(student_id);
CREATE INDEX idx_student_wordlists_wordlist ON student_wordlists(wordlist_id);
```

#### 3.2.5 student_word_progress (학생별 단어 진도)

```sql
CREATE TABLE student_word_progress (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    word_id INT REFERENCES words(id) ON DELETE CASCADE,
    status VARCHAR(20) CHECK (status IN ('not_started', 'skipped', 'completed')) DEFAULT 'not_started',
    skip_count INT DEFAULT 0,
    completed_date DATE,
    next_appear_date DATE,
    user_note TEXT,
    help_provided_count INT DEFAULT 0,
    intensive_completed_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(student_id, word_id)
);

-- 인덱스
CREATE INDEX idx_progress_student ON student_word_progress(student_id);
CREATE INDEX idx_progress_status ON student_word_progress(status);
CREATE INDEX idx_progress_next_date ON student_word_progress(next_appear_date);
CREATE INDEX idx_progress_composite ON student_word_progress(student_id, status, next_appear_date);
```

#### 3.2.6 completed_wordlists (완성 단어장)

```sql
CREATE TABLE completed_wordlists (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    wordlist_id UUID REFERENCES wordlists(id) ON DELETE CASCADE,
    day_number INT NOT NULL,
    word_ids INT[] NOT NULL,
    completed_date DATE NOT NULL,
    online_test_completed BOOLEAN DEFAULT FALSE,
    online_test_score INT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_completed_student ON completed_wordlists(student_id);
CREATE INDEX idx_completed_wordlist ON completed_wordlists(wordlist_id);
```

#### 3.2.7 online_tests (온라인 평가 기록)

```sql
CREATE TABLE online_tests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    completed_wordlist_id UUID REFERENCES completed_wordlists(id) ON DELETE CASCADE,
    test_date TIMESTAMP DEFAULT NOW(),
    total_questions INT NOT NULL,
    correct_count INT NOT NULL,
    score INT NOT NULL,
    wrong_word_ids INT[],
    test_duration_seconds INT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_online_tests_student ON online_tests(student_id);
CREATE INDEX idx_online_tests_wordlist ON online_tests(completed_wordlist_id);
```

#### 3.2.8 offline_tests (오프라인 시험 기록)

```sql
CREATE TABLE offline_tests (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    teacher_id UUID REFERENCES users(id) ON DELETE SET NULL,
    student_id UUID REFERENCES users(id) ON DELETE CASCADE,
    completed_wordlist_ids UUID[],
    test_date DATE NOT NULL,
    total_questions INT NOT NULL,
    correct_count INT NOT NULL,
    wrong_word_ids INT[],
    created_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_offline_tests_teacher ON offline_tests(teacher_id);
CREATE INDEX idx_offline_tests_student ON offline_tests(student_id);
```

### 3.3 뷰 (View)

#### 3.3.1 학생별 진도 요약

```sql
CREATE VIEW student_progress_summary AS
SELECT 
    swl.student_id,
    swl.wordlist_id,
    w.name as wordlist_name,
    w.total_words,
    COUNT(CASE WHEN swp.status = 'completed' THEN 1 END) as completed_count,
    COUNT(CASE WHEN swp.status = 'skipped' THEN 1 END) as skipped_count,
    ROUND(
        COUNT(CASE WHEN swp.status = 'completed' THEN 1 END)::DECIMAL / 
        w.total_words * 100, 
        1
    ) as progress_percentage
FROM student_wordlists swl
JOIN wordlists w ON swl.wordlist_id = w.id
LEFT JOIN words wd ON wd.wordlist_id = w.id
LEFT JOIN student_word_progress swp ON swp.word_id = wd.id AND swp.student_id = swl.student_id
GROUP BY swl.student_id, swl.wordlist_id, w.name, w.total_words;
```

#### 3.3.2 단어장별 Skip 통계

```sql
CREATE VIEW wordlist_skip_stats AS
SELECT 
    w.wordlist_id,
    w.word_text,
    w.meaning,
    SUM(swp.skip_count) as total_skip_count,
    COUNT(DISTINCT swp.student_id) as student_count,
    ROUND(AVG(swp.skip_count), 1) as avg_skip_per_student
FROM student_word_progress swp
JOIN words w ON swp.word_id = w.id
WHERE swp.skip_count > 0
GROUP BY w.wordlist_id, w.id, w.word_text, w.meaning
ORDER BY total_skip_count DESC;
```

------

## 4. 핵심 기능 명세

### 4.1 학생 기능

| 기능 ID | 기능명            | 설명                                                 | 우선순위  |
| ------- | ----------------- | ---------------------------------------------------- | --------- |
| S-01    | 단어 학습         | 순차적으로 단어 1개씩 표시, [안다]/[모른다] 버튼     | P0 (필수) |
| S-02    | 완료 단어 목록    | 오늘 완료한 단어를 하단에 실시간 누적 표시           | P0 (필수) |
| S-03    | Skip 모달 (1-2회) | 최소 정보 모달 (뜻 + 발음만)                         | P0 (필수) |
| S-04    | Skip 모달 (3-4회) | 중간 정보 모달 (뜻 + 예문 + 연상법 + 발음)           | P0 (필수) |
| S-05    | Skip 모달 (5회+)  | 미션 모달 (4지선다, 빈칸, 타이핑 미션)               | P1 (중요) |
| S-06    | 일일 목표 달성    | 50개 완료 시 축하 화면 + 온라인 평가 안내            | P0 (필수) |
| S-07    | 온라인 평가       | 완료 단어 중 20% 무작위 출제, 주관식 입력, 자동 채점 | P0 (필수) |
| S-08    | 완성 단어장 보기  | Day별 완료 단어 목록 + 온라인 평가 점수              | P1 (중요) |
| S-09    | 진도 대시보드     | 전체 진도율, 연속 학습일, 평균 점수                  | P1 (중요) |
| S-10    | 설정 (일일 목표)  | 일일 목표 개수 설정 (30/50/70/100개)                 | P2 (선택) |

### 4.2 강사 기능

| 기능 ID | 기능명                  | 설명                                             | 우선순위  |
| ------- | ----------------------- | ------------------------------------------------ | --------- |
| T-01    | 학생 관리               | 학생 등록, 단어장 배정                           | P0 (필수) |
| T-02    | 단어장별 대시보드       | 단어장 기준 학생 목록, 평균 진도율               | P0 (필수) |
| T-03    | 학생별 진도 모니터링    | 개별 학생 상세 진도, Skip 패턴                   | P0 (필수) |
| T-04    | Skip 단어 통계          | 단어장별 가장 많이 Skip된 단어 TOP 20            | P1 (중요) |
| T-05    | 온라인 평가 분석        | 평균 점수 추이, 70점 이하 학생, 자주 틀리는 단어 | P1 (중요) |
| T-06    | 오프라인 시험 출제      | Day 선택, 문항 수 설정, PDF 시험지 생성          | P1 (중요) |
| T-07    | 오프라인 시험 결과 입력 | 틀린 단어 체크, 점수 자동 계산, 학생 알림        | P1 (중요) |
| T-08    | 단어장 관리             | CSV 가져오기, 단어 편집, 예문/연상법 입력        | P2 (선택) |

------

## 5. 화면별 상세 스펙

### 5.1 학생 화면

#### 5.1.1 학습 화면 (메인 화면)

**레이아웃**

```
┌─────────────────────────────┐
│ [상단 바]                    │ ← 30%
│ - 진도: "오늘의 학습 (23/50)"│
│ - 현재 단어 (크게 표시)      │
│ - [안다] [모른다] 버튼       │
├─────────────────────────────┤
│ [하단 영역]                  │ ← 70%
│ - 제목: "완료한 단어 (23/50)"│
│ - 스크롤 리스트 (역순)       │
│   23. knowledge ✨           │
│   22. success               │
│   21. computer              │
│   ...                       │
└─────────────────────────────┘
```

**요구사항**

- 상단 현재 단어는 `words` 테이블에서 다음 조건으로 조회:

  ```sql
  SELECT w.* FROM words wLEFT JOIN student_word_progress swp   ON w.id = swp.word_id AND swp.student_id = :student_idWHERE w.wordlist_id = :wordlist_id  AND (    swp.status IS NULL     OR swp.status = 'not_started'    OR (swp.status = 'skipped' AND swp.next_appear_date <= CURRENT_DATE)  )ORDER BY w.sequence_order ASCLIMIT 1;
  ```

- [안다] 버튼 클릭 시:

  1. `student_word_progress` 업데이트 (`status='completed'`)
  2. 완료 목록 최상단에 추가 (애니메이션 효과)
  3. 오늘의 목표 카운트 +1
  4. 다음 단어 자동 로드

- [모른다] 버튼 클릭 시:

  1. 현재 `skip_count` 조회
  2. Skip 횟수에 따라 적절한 모달 표시

- 완료 목록:

  - 최신 항목이 최상단 (역순 정렬)
  - 방금 추가된 항목에 ✨ 이모지 (3초간)
  - 무한 스크롤

**상태 관리**

```typescript
interface StudyState {
  currentWord: Word | null;
  completedWords: Word[];
  todayProgress: number;
  dailyGoal: number;
  showSkipModal: boolean;
  skipCount: number;
}
```

#### 5.1.2 Skip 모달 (1-2회)

**디자인 스펙**

- 크기: 화면의 40%, 최대 너비 320px
- 배경: 50% 투명 검은색 딤
- 모달: 흰색 배경, border-radius: 16px, padding: 24px
- 애니메이션: fade (200ms)

**내용**

```
┌────────────────────┐
│   [단어]            │ ← font-size: 32px, bold
│                    │
│  💡 [뜻]           │ ← font-size: 16px
│                    │
│  🔊 [발음]         │ ← 버튼 (작게)
│                    │
│  [내일 다시]        │ ← 주 버튼
└────────────────────┘
```

**동작**

- [내일 다시] 클릭 시:
  1. `student_word_progress` 업데이트:
     - `status = 'skipped'`
     - `skip_count = skip_count + 1`
     - `next_appear_date = CURRENT_DATE + 1`
  2. 모달 닫기
  3. 다음 단어 로드

#### 5.1.3 Skip 모달 (3-4회)

**디자인 스펙**

- 크기: 화면의 70%, 최대 너비 500px, 최대 높이 80%
- 스크롤 가능
- 닫기 버튼 (우측 상단)
- 애니메이션: slide up (300ms)

**내용**

```
┌──────────────────────┐
│  [✕]                 │ ← 닫기 버튼
│                      │
│  [단어]              │ ← 36px
│                      │
│  ⚠️ N번 건너뛰었어요! │ ← 경고 배너
│                      │
│  ──────────────────  │
│                      │
│  💡 뜻               │
│  [뜻 내용]           │
│                      │
│  📖 예문             │
│  [예문]              │
│  (번역)              │
│                      │
│  🧠 연상법           │
│  [연상법]            │
│                      │
│  🔊 [발음 듣기]       │
│                      │
│  ──────────────────  │
│                      │
│  [내일 다시]          │
└──────────────────────┘
```

**동작**

- Skip 1-2회와 동일하게 업데이트
- 추가: `help_provided_count = help_provided_count + 1`

#### 5.1.4 Skip 모달 (5회+) - 미션 모드

**미션 구성**

1. **미션 1: 4지선다**
   - 정답 1개 + 오답 3개 (유사한 뜻)
   - 오답은 같은 단어장 내 다른 단어 뜻에서 랜덤 선택
2. **미션 2: 빈칸 채우기**
   - 예문에서 단어 부분을 빈칸으로
   - 텍스트 입력 (정확히 일치해야 정답)
   - 힌트: 첫 3글자 제공
3. **미션 3: 스피드 타이핑**
   - 단어를 보고 3초 안에 입력
   - 카운트다운 타이머 표시
   - 정확히 입력해야 통과

**미션 완료 후**

```
┌──────────────────────┐
│  🎉 미션 완료!        │
│                      │
│  [단어]              │
│  [뜻]                │
│                      │
│  이 단어를 어떻게     │
│  할까요?             │
│                      │
│  ┌────────────────┐  │
│  │ ✓ 완료로 체크  │  │
│  │ (오늘 목표 포함)│  │
│  └────────────────┘  │
│                      │
│  ┌────────────────┐  │
│  │ ↻ 내일 다시    │  │
│  │ (한 번 더 복습)│  │
│  └────────────────┘  │
└──────────────────────┘
```

**동작**

- [완료로 체크] 선택 시:
  - `status = 'completed'`
  - `completed_date = CURRENT_DATE`
  - 오늘의 목표 카운트 +1
  - 완료 목록에 추가
- [내일 다시] 선택 시:
  - `status = 'skipped'`
  - `next_appear_date = CURRENT_DATE + 1`
- 공통:
  - `intensive_completed_count = intensive_completed_count + 1`

#### 5.1.5 온라인 평가 화면

**평가 시작**

```
┌─────────────────────────┐
│  🎯 온라인 평가          │
│                         │
│  오늘 완료한 50개 중     │
│  10개를 무작위 평가      │
│                         │
│  ⏱️ 제한 시간: 5분      │
│                         │
│  [시작하기]              │
└─────────────────────────┘
```

**평가 진행**

```
┌─────────────────────────┐
│ 문제 3/10    ⏱️ 3:24    │
├─────────────────────────┤
│                         │
│      achieve            │
│                         │
│  뜻을 입력하세요:        │
│  ┌─────────────────┐    │
│  │ [입력창]        │    │
│  └─────────────────┘    │
│                         │
│  [이전] [다음] [제출]    │
└─────────────────────────┘
```

**평가 결과**

```
┌─────────────────────────┐
│  📊 평가 완료!           │
│                         │
│  점수: 80점 (8/10)       │
│                         │
│  ✅ 정답 (8개)           │
│  apple, book, ...       │
│                         │
│  ❌ 오답 (2개)           │
│  achieve                │
│  ├─ 내 답: "성취"       │
│  └─ 정답: "성취하다"     │
│                         │
│  💡 틀린 단어는 복습     │
│     목록에 추가됨        │
│                         │
│  [확인]                  │
└─────────────────────────┘
```

**로직**

```typescript
// 1. 평가 문제 생성
function createOnlineTest(completedWordlistId: string) {
  const wordlist = getCompletedWordlist(completedWordlistId);
  const allWordIds = wordlist.word_ids; // 50개
  const quizCount = Math.floor(allWordIds.length * 0.2); // 10개
  const selectedIds = randomSample(allWordIds, quizCount);
  
  const questions = selectedIds.map(wordId => ({
    wordId,
    word: getWord(wordId).word_text,
    correctAnswer: getWord(wordId).meaning
  }));
  
  shuffle(questions);
  return questions;
}

// 2. 자동 채점
function gradeTest(answers: Record<number, string>, questions: Question[]) {
  let score = 0;
  const wrongWords = [];
  
  questions.forEach(q => {
    const studentAnswer = normalize(answers[q.wordId]);
    const correctAnswer = normalize(q.correctAnswer);
    
    if (studentAnswer === correctAnswer) {
      score++;
    } else {
      wrongWords.push({
        wordId: q.wordId,
        word: q.word,
        studentAnswer: answers[q.wordId],
        correctAnswer: q.correctAnswer
      });
    }
  });
  
  const percentage = Math.round((score / questions.length) * 100);
  return { score: percentage, wrongWords };
}

// 정규화 함수
function normalize(text: string): string {
  return text.trim().toLowerCase().replace(/\s+/g, '');
}
```

### 5.2 강사 화면

#### 5.2.1 메인 대시보드

```
┌─────────────────────────────┐
│  📚 내 단어장 관리            │
│                             │
│  ┌─────────────────────┐    │
│  │ 📖 수능 영단어       │    │
│  │ (2,000개)           │    │
│  │                     │    │
│  │ 학습 중: 15명        │    │
│  │ 평균 진도: 45%      │    │
│  │ 평균 점수: 78점     │    │
│  │                     │    │
│  │ [상세] [통계]        │    │
│  └─────────────────────┘    │
│                             │
│  [+ 새 단어장]               │
└─────────────────────────────┘
```

**데이터 조회**

```sql
-- 단어장별 요약 통계
SELECT 
    w.id,
    w.name,
    w.total_words,
    COUNT(DISTINCT swl.student_id) as student_count,
    AVG(sps.progress_percentage) as avg_progress,
    AVG(ot.score) as avg_online_score
FROM wordlists w
LEFT JOIN student_wordlists swl ON w.id = swl.wordlist_id
LEFT JOIN student_progress_summary sps ON sps.wordlist_id = w.id
LEFT JOIN completed_wordlists cwl ON cwl.student_id = swl.student_id AND cwl.wordlist_id = w.id
LEFT JOIN online_tests ot ON ot.completed_wordlist_id = cwl.id
WHERE w.created_by = :teacher_id
GROUP BY w.id, w.name, w.total_words;
```

#### 5.2.2 학생 현황 화면

```
┌─────────────────────────────┐
│  [학생 현황] [Skip] [평가]   │
│  ═══════════                │
│                             │
│  학생 현황 (15명)            │
│                             │
│  ┌───────────────────────┐  │
│  │이름 │진도│Skip│점수│  │  │
│  ├───────────────────────┤  │
│  │철수│60%│12%│85점│🟢│  │  │
│  │영희│55%│8% │90점│🟢│  │  │
│  │지민│20%│25%│65점│⚠️│  │  │
│  │민수│10%│5% │-  │🔴│  │  │
│  └───────────────────────┘  │
│                             │
│  [학생 추가]                 │
└─────────────────────────────┘
```

**상태 표시 로직**

```typescript
function getStudentStatus(progress: number, skipRate: number, score: number) {
  if (progress < 15 || !score) return '🔴'; // 관심 필요
  if (progress < 30 || skipRate > 20 || score < 70) return '⚠️'; // 주의
  return '🟢'; // 정상
}
```

#### 5.2.3 Skip 통계 화면

```
┌─────────────────────────────┐
│  📊 가장 어려운 단어 TOP 20   │
│                             │
│  ┌───────────────────────┐  │
│  │순위│단어      │Skip│명│  │
│  ├───────────────────────┤  │
│  │1  │conscientious│38│15││  │
│  │2  │ambiguous    │32│14││  │
│  │3  │meticulous   │28│12││  │
│  └───────────────────────┘  │
│                             │
│  💡 추상적 개념 단어가       │
│     어려움                   │
│                             │
│  [PDF 다운로드]              │
└─────────────────────────────┘
```

**쿼리**

```sql
SELECT * FROM wordlist_skip_stats
WHERE wordlist_id = :wordlist_id
ORDER BY total_skip_count DESC
LIMIT 20;
```

#### 5.2.4 오프라인 시험 출제

```
┌─────────────────────────────┐
│  1️⃣ 학생 선택                │
│  [김철수 ▼]                  │
│                             │
│  완료 단어: 1,200개          │
│  완성 단어장: 24개           │
│                             │
│  2️⃣ 범위 선택                │
│  ☑ Day 1 (50개) - 85점      │
│  ☑ Day 2 (50개) - 90점      │
│  ☐ Day 3 (50개) - 80점      │
│                             │
│  선택: 100개                 │
│                             │
│  3️⃣ 설정                     │
│  문항 수: [20 ▼]            │
│  유형: ⦿ 영→한 ⭕ 한→영     │
│                             │
│  [시험지 생성]               │
└─────────────────────────────┘
```

**PDF 생성 로직**

```typescript
function generateTestPDF(config: TestConfig) {
  // 1. 선택된 Day들의 word_ids 수집
  const allWordIds = config.selectedDays
    .map(day => getCompletedWordlist(day.id).word_ids)
    .flat();
  
  // 2. 랜덤 선택
  const selectedIds = randomSample(allWordIds, config.questionCount);
  
  // 3. 단어 정보 가져오기
  const words = selectedIds.map(id => getWord(id));
  
  // 4. PDF 생성
  const pdf = new PDFDocument();
  pdf.text(`단어 평가 (${config.studentName})`);
  pdf.text(`Day ${config.dayRange} 범위 | ${config.questionCount}문항`);
  
  words.forEach((word, i) => {
    if (config.type === 'eng-to-kor') {
      pdf.text(`${i+1}. ${word.word_text}     (        )`);
    } else {
      pdf.text(`${i+1}. ${word.meaning}     (        )`);
    }
  });
  
  return pdf;
}
```

------

## 6. 주요 로직 설명

### 6.1 다음 단어 가져오기 로직

```typescript
async function getNextWord(studentId: string, wordlistId: string): Promise<Word | null> {
  // 1. 미완료 단어 또는 오늘 다시 볼 Skip 단어 조회
  const query = `
    SELECT w.* 
    FROM words w
    LEFT JOIN student_word_progress swp 
      ON w.id = swp.word_id AND swp.student_id = $1
    WHERE w.wordlist_id = $2
      AND (
        swp.status IS NULL 
        OR swp.status = 'not_started'
        OR (swp.status = 'skipped' AND swp.next_appear_date <= CURRENT_DATE)
      )
    ORDER BY w.sequence_order ASC
    LIMIT 1
  `;
  
  const result = await db.query(query, [studentId, wordlistId]);
  return result.rows[0] || null;
}
```

### 6.2 일일 목표 달성 확인

```typescript
async function checkDailyGoal(studentId: string, wordlistId: string): Promise<boolean> {
  // 오늘 완료한 단어 개수 조회
  const query = `
    SELECT COUNT(*) as count
    FROM student_word_progress
    WHERE student_id = $1
      AND word_id IN (
        SELECT id FROM words WHERE wordlist_id = $2
      )
      AND status = 'completed'
      AND completed_date = CURRENT_DATE
  `;
  
  const result = await db.query(query, [studentId, wordlistId]);
  const todayCount = result.rows[0].count;
  
  const user = await getUser(studentId);
  return todayCount >= user.daily_goal;
}
```

### 6.3 완성 단어장 생성

```typescript
async function createCompletedWordlist(studentId: string, wordlistId: string) {
  // 1. 오늘 완료한 단어 50개 조회
  const query = `
    SELECT word_id
    FROM student_word_progress
    WHERE student_id = $1
      AND word_id IN (SELECT id FROM words WHERE wordlist_id = $2)
      AND status = 'completed'
      AND completed_date = CURRENT_DATE
    ORDER BY updated_at ASC
    LIMIT 50
  `;
  
  const result = await db.query(query, [studentId, wordlistId]);
  const wordIds = result.rows.map(r => r.word_id);
  
  // 2. Day 번호 계산
  const countQuery = `
    SELECT COUNT(*) as count
    FROM completed_wordlists
    WHERE student_id = $1 AND wordlist_id = $2
  `;
  const countResult = await db.query(countQuery, [studentId, wordlistId]);
  const dayNumber = countResult.rows[0].count + 1;
  
  // 3. 완성 단어장 생성
  const insertQuery = `
    INSERT INTO completed_wordlists 
    (student_id, wordlist_id, day_number, word_ids, completed_date)
    VALUES ($1, $2, $3, $4, CURRENT_DATE)
    RETURNING id
  `;
  
  await db.query(insertQuery, [studentId, wordlistId, dayNumber, wordIds]);
}
```

### 6.4 온라인 평가 자동 채점

```typescript
async function gradeOnlineTest(
  testId: string, 
  answers: Record<number, string>
): Promise<TestResult> {
  // 1. 정답 가져오기
  const questions = await getTestQuestions(testId);
  
  // 2. 채점
  let correctCount = 0;
  const wrongWords: WrongWord[] = [];
  
  for (const q of questions) {
    const studentAnswer = normalize(answers[q.wordId] || '');
    const correctAnswer = normalize(q.correctAnswer);
    
    if (studentAnswer === correctAnswer) {
      correctCount++;
    } else {
      wrongWords.push({
        wordId: q.wordId,
        word: q.word,
        studentAnswer: answers[q.wordId],
        correctAnswer: q.correctAnswer
      });
    }
  }
  
  // 3. 점수 계산
  const score = Math.round((correctCount / questions.length) * 100);
  
  // 4. 결과 저장
  await saveTestResult(testId, {
    correctCount,
    score,
    wrongWordIds: wrongWords.map(w => w.wordId)
  });
  
  // 5. completed_wordlists 업데이트
  await updateCompletedWordlist(testId, {
    online_test_completed: true,
    online_test_score: score
  });
  
  return { score, correctCount, wrongWords };
}

function normalize(text: string): string {
  return text
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '')
    .replace(/[.,!?]/g, '');
}
```

### 6.5 Skip 횟수에 따른 모달 분기

```typescript
function getSkipModalType(skipCount: number): ModalType {
  if (skipCount <= 2) {
    return 'minimal'; // 최소 모달
  } else if (skipCount >= 3 && skipCount < 5) {
    return 'medium'; // 중간 모달
  } else {
    return 'full'; // 미션 모달
  }
}
```

------

## 7. 기술 스택

### 7.1 추천 기술 스택

#### 프론트엔드

```
- Framework: React Native (with Expo)
  → 이유: iOS/Android 동시 개발, 빠른 프로토타이핑
  
- 상태 관리: Zustand 또는 React Query
  → 이유: 단순하고 학습 곡선 낮음
  
- UI 라이브러리: React Native Paper
  → 이유: Material Design 기반, 완성도 높은 컴포넌트
  
- 네비게이션: React Navigation
  
- 애니메이션: React Native Reanimated
```

#### 백엔드

```
- 데이터베이스: Supabase (PostgreSQL)
  → 이유: 
    - 실시간 기능 내장
    - Row Level Security로 권한 관리 간단
    - 무료 플랜으로 프로토타입 가능
    - Auth 기능 내장
  
- API: Supabase Client (REST)
  
- 파일 저장소: Supabase Storage
  → 발음 파일, PDF 저장용
```

#### 기타

```
- PDF 생성: react-native-pdf 또는 pdfkit
- 차트: recharts (강사 대시보드)
- 배포: Expo EAS (앱 배포)
```

### 7.2 프로젝트 구조

```
todo-voca/
├── src/
│   ├── screens/           # 화면
│   │   ├── student/
│   │   │   ├── StudyScreen.tsx
│   │   │   ├── DashboardScreen.tsx
│   │   │   ├── OnlineTestScreen.tsx
│   │   │   └── CompletedWordlistsScreen.tsx
│   │   └── teacher/
│   │       ├── DashboardScreen.tsx
│   │       ├── StudentProgressScreen.tsx
│   │       ├── SkipStatsScreen.tsx
│   │       └── TestGenerateScreen.tsx
│   ├── components/        # 재사용 컴포넌트
│   │   ├── modals/
│   │   │   ├── MinimalSkipModal.tsx
│   │   │   ├── MediumSkipModal.tsx
│   │   │   └── FullSkipModal.tsx
│   │   ├── WordCard.tsx
│   │   ├── ProgressBar.tsx
│   │   └── ...
│   ├── services/          # API 호출
│   │   ├── supabase.ts
│   │   ├── wordService.ts
│   │   ├── progressService.ts
│   │   └── testService.ts
│   ├── hooks/             # Custom Hooks
│   │   ├── useStudySession.ts
│   │   ├── useOnlineTest.ts
│   │   └── ...
│   ├── types/             # TypeScript 타입
│   │   ├── word.ts
│   │   ├── progress.ts
│   │   └── test.ts
│   ├── utils/             # 유틸리티
│   │   ├── normalize.ts
│   │   ├── randomSample.ts
│   │   └── ...
│   └── constants/         # 상수
│       ├── config.ts
│       └── colors.ts
├── assets/
├── App.tsx
└── package.json
```

------

## 8. 개발 로드맵

### 8.1 Phase 1: MVP (2주)

#### Week 1: 학생 기능 핵심

```
Day 1-2: 환경 설정 및 DB 구축
- Expo 프로젝트 생성
- Supabase 설정
- 테이블 생성 (users, wordlists, words, student_word_progress)
- Row Level Security 설정

Day 3-4: 학습 화면
- 단어 학습 화면 UI
- [안다] / [모른다] 버튼 동작
- 완료 단어 목록 (실시간 누적)
- 다음 단어 가져오기 로직

Day 5-6: Skip 모달 (1-2회, 3-4회)
- 최소 모달 구현
- 중간 모달 구현
- Skip 횟수에 따른 분기 로직
- DB 업데이트 (skip_count, next_appear_date)

Day 7: 일일 목표 달성
- 50개 완료 감지
- 축하 화면
- 완성 단어장 생성 로직
```

#### Week 2: 온라인 평가 + 강사 기본

```
Day 8-9: 온라인 평가
- 평가 문제 생성 (20% 무작위)
- 주관식 입력 화면
- 자동 채점 로직
- 결과 화면

Day 10-11: 강사 대시보드
- 로그인 (강사/학생 분리)
- 단어장 목록 화면
- 학생 현황 화면 (진도율, Skip 비율)

Day 12-13: 학생 관리
- 학생 등록 기능
- 단어장 배정 기능
- 개별 학생 상세 보기

Day 14: 테스트 및 버그 수정
- 전체 플로우 테스트
- 버그 수정
- MVP 배포
```

### 8.2 Phase 2: 핵심 기능 보강 (2주)

#### Week 3: Skip 5회+ & 통계

```
Day 15-17: Skip 미션 모달
- 4지선다 미션
- 빈칸 채우기 미션
- 스피드 타이핑 미션
- 미션 완료 후 선택 (완료 or 내일)

Day 18-19: Skip 통계
- Skip 단어 통계 화면 (강사)
- 단어장별 어려운 단어 TOP 20
- 학생별 Skip 패턴 분석

Day 20-21: 온라인 평가 분석
- 평균 점수 추이 차트
- 70점 이하 학생 알림
- 자주 틀리는 단어 분석
```

#### Week 4: 오프라인 시험 & 완성

```
Day 22-24: 오프라인 시험
- 시험 출제 화면
- PDF 생성 로직
- 시험 결과 입력
- 학생 알림

Day 25-26: 완성 단어장
- Day별 단어장 보기 (학생)
- 복습 모드
- PDF 다운로드

Day 27-28: 최종 테스트
- 전체 기능 통합 테스트
- 성능 최적화
- 버그 수정
```

### 8.3 Phase 3: 향상 기능 (선택)

```
- 단어장 관리 (CSV 가져오기, 편집)
- 학부모 리포트 자동 발송
- 푸시 알림 (일일 목표 미달성, 학습 독려)
- AI 연상법 자동 생성
- 이미지 검색 기능
- 음성 인식 발음 평가
```

------

## 9. 개발 시 주의사항

### 9.1 성능 최적화

```typescript
// ❌ 나쁜 예: 매번 전체 단어 조회
const allWords = await getAllWords(wordlistId);
const nextWord = allWords.find(w => !isCompleted(w));

// ✅ 좋은 예: DB 레벨에서 필터링
const nextWord = await getNextWord(studentId, wordlistId);
```

### 9.2 데이터 일관성

```typescript
// ❌ 나쁜 예: 트랜잭션 없이 여러 업데이트
await updateProgress(wordId, 'completed');
await incrementTodayCount(studentId);
await createWordlistIfNeeded(studentId);

// ✅ 좋은 예: 트랜잭션 사용
await db.transaction(async (trx) => {
  await trx.updateProgress(wordId, 'completed');
  await trx.incrementTodayCount(studentId);
  await trx.createWordlistIfNeeded(studentId);
});
```

### 9.3 에러 처리

```typescript
// 모든 비동기 작업에 에러 처리
try {
  const nextWord = await getNextWord(studentId, wordlistId);
  if (!nextWord) {
    showMessage('모든 단어를 완료했습니다!');
    return;
  }
  setCurrentWord(nextWord);
} catch (error) {
  console.error('단어 로드 실패:', error);
  showErrorAlert('단어를 불러오는데 실패했습니다.');
}
```

### 9.4 보안

```sql
-- Row Level Security 필수 설정
-- 학생은 자기 데이터만 조회/수정
ALTER TABLE student_word_progress ENABLE ROW LEVEL SECURITY;

CREATE POLICY student_progress_policy ON student_word_progress
  FOR ALL
  TO authenticated
  USING (student_id = auth.uid());

-- 강사는 자기가 관리하는 학생 데이터만 조회
CREATE POLICY teacher_progress_policy ON student_word_progress
  FOR SELECT
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM student_wordlists swl
      JOIN wordlists w ON swl.wordlist_id = w.id
      WHERE swl.student_id = student_word_progress.student_id
        AND w.created_by = auth.uid()
    )
  );
```

------

## 10. 테스트 시나리오

### 10.1 학생 E2E 테스트

```
시나리오 1: 첫 학습 (Day 1)
1. 로그인
2. [학습 시작하기] 클릭
3. 단어 50개 학습
   - 30개 [안다] 클릭 → 완료 목록에 추가 확인
   - 20개 [모른다] 클릭 → 모달 표시 확인
4. 50개 완료 → 축하 화면 확인
5. 온라인 평가 시작
6. 10문항 입력 후 제출
7. 결과 확인 (점수, 오답)
8. 로그아웃

예상 결과:
- completed_wordlists에 Day 1 생성
- online_tests에 평가 기록 생성
- 완료한 30개 단어 status='completed'
- Skip한 20개 단어 status='skipped', next_appear_date=내일
시나리오 2: 연속 학습 (Day 2)
1. 로그인
2. [학습 시작하기] 클릭
3. 첫 단어가 어제 Skip한 단어인지 확인
4. 해당 단어 [안다] 클릭
5. 50개 완료까지 반복
6. 온라인 평가 완료

예상 결과:
- 어제 Skip한 단어가 재등장
- Day 2 완성 단어장 생성
시나리오 3: Skip 3회
1. 특정 단어를 3번 Skip
2. 3번째 Skip 시 중간 모달 표시 확인
3. 예문, 연상법 표시 확인
4. [내일 다시] 클릭

예상 결과:
- skip_count = 3
- help_provided_count = 1
- 다음날 재등장
```

### 10.2 강사 E2E 테스트

```
시나리오 1: 학생 관리
1. 강사 로그인
2. [학생 추가] 클릭
3. 이메일 입력 → 초대 발송
4. 단어장 배정
5. 학생 현황 확인

예상 결과:
- student_wordlists에 배정 기록
- 학생 목록에 표시
시나리오 2: 통계 확인
1. [Skip 통계] 탭 클릭
2. 어려운 단어 TOP 20 확인
3. [온라인 평가] 탭 클릭
4. 평균 점수 추이 확인
5. 70점 이하 학생 확인

예상 결과:
- 통계 정확히 표시
- 차트 렌더링 정상
시나리오 3: 오프라인 시험 출제
1. [오프라인 시험 출제] 클릭
2. 학생 선택
3. Day 1-2 선택 (100개)
4. 문항 수 20개 설정
5. [시험지 생성] 클릭
6. PDF 다운로드

예상 결과:
- 100개 중 20개 무작위 선택
- PDF 정상 생성
- 시험지 양식 정확
```

------

## 11. API 명세 (참고용)

### 11.1 학생 API

```typescript
// 다음 단어 가져오기
GET /api/student/next-word?wordlist_id={id}
Response: {
  word: Word,
  skipCount: number
}

// 단어 완료 처리
POST /api/student/complete-word
Body: {
  wordId: number,
  wordlistId: string
}
Response: {
  success: boolean,
  todayProgress: number,
  isGoalAchieved: boolean
}

// 단어 Skip 처리
POST /api/student/skip-word
Body: {
  wordId: number,
  note?: string
}
Response: {
  success: boolean,
  skipCount: number
}

// 온라인 평가 시작
POST /api/student/start-online-test
Body: {
  completedWordlistId: string
}
Response: {
  testId: string,
  questions: Question[]
}

// 온라인 평가 제출
POST /api/student/submit-online-test
Body: {
  testId: string,
  answers: Record<number, string>
}
Response: {
  score: number,
  correctCount: number,
  wrongWords: WrongWord[]
}
```

### 11.2 강사 API

```typescript
// 단어장 목록
GET /api/teacher/wordlists
Response: {
  wordlists: Wordlist[]
}

// 학생 목록 (단어장별)
GET /api/teacher/students?wordlist_id={id}
Response: {
  students: Student[]
}

// Skip 통계
GET /api/teacher/skip-stats?wordlist_id={id}
Response: {
  topWords: SkipStat[]
}

// 시험 출제
POST /api/teacher/generate-test
Body: {
  studentId: string,
  dayNumbers: number[],
  questionCount: number,
  type: 'eng-to-kor' | 'kor-to-eng'
}
Response: {
  pdfUrl: string
}
```

------

## 12. 체크리스트

### 12.1 개발 완료 기준

#### Phase 1 MVP

- [ ] 학생 회원가입/로그인
- [ ] 강사 회원가입/로그인
- [ ] 단어 학습 화면 (안다/모른다)
- [ ] 완료 단어 목록 실시간 누적
- [ ] Skip 모달 (1-2회, 3-4회)
- [ ] 일일 목표 50개 달성 감지
- [ ] 온라인 평가 (문제 생성, 채점, 결과)
- [ ] 강사 대시보드 (단어장 목록)
- [ ] 학생 현황 (진도율, Skip 비율)
- [ ] 학생 등록 및 단어장 배정

#### Phase 2

- [ ] Skip 모달 (5회+) 미션
- [ ] Skip 통계 화면
- [ ] 온라인 평가 분석 (차트, 알림)
- [ ] 오프라인 시험 출제 (PDF)
- [ ] 오프라인 시험 결과 입력
- [ ] 완성 단어장 보기 (학생)

### 12.2 배포 전 확인사항

- [ ] 모든 테이블에 인덱스 설정
- [ ] Row Level Security 설정 완료
- [ ] 환경 변수 설정 (.env)
- [ ] 에러 로깅 설정 (Sentry 등)
- [ ] 앱 아이콘 및 스플래시 스크린
- [ ] 이용약관 및 개인정보처리방침
- [ ] 앱 스토어 스크린샷 준비
- [ ] 성능 테스트 (1000개 단어 로드 속도)
- [ ] 보안 테스트 (SQL Injection, XSS)

------

## 부록 A. Supabase 설정 가이드

### A.1 프로젝트 생성

```bash
# Supabase CLI 설치
npm install -g supabase

# 프로젝트 초기화
supabase init

# 로컬 개발 서버 시작
supabase start
```

### A.2 SQL 스크립트 실행

```sql
-- 위의 테이블 생성 SQL을 순서대로 실행
-- migrations 폴더에 저장 권장
```

### A.3 Row Level Security 설정

```sql
-- 모든 테이블에 RLS 활성화 및 정책 설정
-- (위의 보안 섹션 참조)
```

------

## 부록 B. 샘플 데이터

### B.1 단어 샘플 (CSV)

```csv
sequence_order,word_text,meaning,example,example_translation,mnemonic
1,apple,사과,I eat an apple every day.,나는 매일 사과를 먹는다.,
2,achieve,성취하다,She achieved her goal.,그녀는 목표를 달성했다.,a(~을 향해) + chieve(도달)
3,knowledge,지식,Knowledge is power.,아는 것이 힘이다.,know(알다) + ledge(끝)
```

------

## 부록 C. 문의 사항

개발 중 궁금한 점이나 명세가 불명확한 부분이 있으면 언제든지 질문해주세요!

------

**이 기획서는 Cursor AI를 활용한 개발을 위해 최적화되었습니다.** **각 섹션을 참고하여 단계별로 구현하시면 됩니다.**