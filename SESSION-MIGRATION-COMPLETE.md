# âœ… "Day" â†’ "íšŒì°¨(Session)" ì™„ì „ ì „í™˜ ì™„ë£Œ

## ğŸ¯ **í•µì‹¬ ë³€ê²½ ì‚¬í•­**

### **1. ê°œë… ì „í™˜**
- âŒ **ê¸°ì¡´**: "Day" (ë‚ ì§œ ê¸°ë°˜)
- âœ… **ë³€ê²½**: "íšŒì°¨(Session)" (ìˆœì„œ ê¸°ë°˜)

### **2. í•µì‹¬ ì² í•™**
> **ë‚ ì§œëŠ” "ê¸°ë¡"ìš©, íšŒì°¨ëŠ” "ë¡œì§"ìš©**
> 
> - `completed_date`: ê¸°ë¡ ëª©ì  (ì–¸ì œ ì™„ë£Œí–ˆëŠ”ì§€)
> - `session_number`: ë¡œì§ ëª©ì  (ëª‡ ë²ˆì§¸ íšŒì°¨ì¸ì§€)

---

## ğŸ“‹ **ë³€ê²½ëœ íŒŒì¼ ëª©ë¡**

### **TypeScript ì½”ë“œ**

#### **1. `hooks/useStudySession.ts`** â­
- **Line 947**: `next_appear_date = null` (ì¦‰ì‹œ ì¬ë“±ì¥)
- **Line 948**: `appearStrategy = 'next_session'`
- **Line 950**: ë¡œê·¸ ë©”ì‹œì§€ ë³€ê²½ "ë‹¤ìŒ íšŒì°¨ì— ìš°ì„  ë“±ì¥"
- **Line 960**: ì£¼ì„ ì¶”ê°€ "ê¸°ë¡ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©"
- **Line 273**: ì£¼ì„ ë³€ê²½ "íšŒì°¨ ì™„ë£Œ í›„..."
- **Line 842**: ì£¼ì„ ë³€ê²½ "ë§ˆì§€ë§‰ íšŒì°¨ ì™„ì„±..."

#### **2. `types/progress.ts`**
- **Line 20**: `day_number` â†’ `session_number`
- ì£¼ì„ ì¶”ê°€: "â­ day_number â†’ session_number ë³€ê²½"

#### **3. `components/student/study-screen.tsx`**
- **Line 86**: ì£¼ì„ ë³€ê²½ "íšŒì°¨ ì™„ë£Œ í›„..."
- **Line 154**: ì£¼ì„ ë³€ê²½ "íšŒì°¨ ì™„ë£Œ vs ì„¸ëŒ€ ì™„ë£Œ"
- **Line 155**: `isDayComplete` â†’ `isSessionComplete`
- **Line 164**: UI í…ìŠ¤íŠ¸ "Day X" â†’ "XíšŒì°¨"
- **Line 249**: Badge í…ìŠ¤íŠ¸ "Day X" â†’ "XíšŒì°¨"

#### **4. `components/student/goal-achieved-modal.tsx`**
- **Line 67**: Badge í…ìŠ¤íŠ¸ "Day X" â†’ "XíšŒì°¨"
- **Line 78**: ì•ˆë‚´ í…ìŠ¤íŠ¸ "Day X" â†’ "XíšŒì°¨"

#### **5. `components/student/test-start-screen.tsx`**
- **Line 33**: í…ìŠ¤íŠ¸ "Day X" â†’ "XíšŒì°¨"

---

### **SQL ìŠ¤í¬ë¦½íŠ¸**

#### **1. `PHASE3-FINAL-SESSION-MIGRATION.sql`** (ìƒˆ íŒŒì¼)
```sql
-- get_next_word í•¨ìˆ˜: ë‚ ì§œ í•„í„°ë§ ì™„ì „ ì œê±°
-- Line 89-92: 
AND (
  swp.status IS NULL 
  OR swp.status = 'not_started'
  OR swp.status = 'skipped'  -- â­ ë‚ ì§œ ì¡°ê±´ ì œê±°!
)
```

**í•µì‹¬ ë³€ê²½:**
- `next_appear_date <= CURRENT_DATE` ì¡°ê±´ ì‚­ì œ
- Skip ë‹¨ì–´ëŠ” **ì¦‰ì‹œ ì¬ë“±ì¥**
- `skip_count` ë†’ì„ìˆ˜ë¡ ìš°ì„  ìˆœìœ„

#### **2. `VERIFY-SESSION-MIGRATION.sql`** (ìƒˆ íŒŒì¼)
- ìŠ¤í‚¤ë§ˆ ê²€ì¦
- RPC í•¨ìˆ˜ ê²€ì¦
- ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
- Skip ë‹¨ì–´ `next_appear_date = NULL` í™•ì¸

---

## ğŸ”§ **ë¡œì§ ë³€ê²½ ìš”ì•½**

### **Before (Day ê¸°ë°˜ - ì˜ëª»ë¨):**
```typescript
// Skip â†’ ë‹¤ìŒë‚ ê¹Œì§€ ì•ˆ ë‚˜ì˜´
const tomorrow = new Date()
tomorrow.setDate(tomorrow.getDate() + 1)
next_appear_date = tomorrow
```

```sql
-- get_next_word: ë‚ ì§œ ë¹„êµ
OR (swp.status = 'skipped' AND swp.next_appear_date <= CURRENT_DATE)
```

### **After (Session ê¸°ë°˜ - ì˜¬ë°”ë¦„):**
```typescript
// Skip â†’ ë‹¤ìŒ íšŒì°¨ì— ì¦‰ì‹œ ì¬ë“±ì¥
next_appear_date = null
appearStrategy = 'next_session'
```

```sql
-- get_next_word: ë‚ ì§œ ì¡°ê±´ ì œê±°
OR swp.status = 'skipped'  -- ì¦‰ì‹œ ì¬ë“±ì¥
ORDER BY 
  CASE WHEN swp.status = 'skipped' THEN 0 ELSE 1 END,  -- Skip ìš°ì„ 
  swp.skip_count DESC  -- skip_count ë†’ì„ìˆ˜ë¡ ìš°ì„ 
```

---

## ğŸ® **ì‚¬ìš©ì ê²½í—˜ ë³€í™”**

### **Before:**
- Skipí•œ ë‹¨ì–´ â†’ **ë‚´ì¼ê¹Œì§€ ì•ˆ ë³´ì„**
- í•˜ë£¨ì— ì—¬ëŸ¬ íšŒì°¨ ì§„í–‰ ì‹œ â†’ **í˜¼ë€**
- ë‚ ì§œ ê¸°ë°˜ í•„í„°ë§ â†’ **ì˜¤ëŠ˜/ë‚´ì¼ ê°œë…**

### **After:**
- Skipí•œ ë‹¨ì–´ â†’ **ë‹¤ìŒ íšŒì°¨ì— ë°”ë¡œ ë“±ì¥**
- íšŒì°¨ ë‹¨ìœ„ë¡œ ì§„í–‰ â†’ **ëª…í™•í•œ ì§„í–‰ë„**
- ìˆœì„œ ê¸°ë°˜ â†’ **ë‚ ì§œì™€ ë¬´ê´€**

---

## ğŸ“Œ **ì‹¤í–‰ ìˆœì„œ**

### **1ë‹¨ê³„: SQL ë§ˆì´ê·¸ë ˆì´ì…˜ (Supabase SQL Editor)**
```sql
-- â­ í•„ìˆ˜! ë¨¼ì € ì‹¤í–‰
-- PHASE2-DAY-TO-SESSION-MIGRATION.sql (ì´ë¯¸ ì‹¤í–‰í–ˆì„ ê²ƒ)

-- â­ ì§€ê¸ˆ ì‹¤í–‰
-- PHASE3-FINAL-SESSION-MIGRATION.sql
```

### **2ë‹¨ê³„: ê²€ì¦ (Supabase SQL Editor)**
```sql
-- VERIFY-SESSION-MIGRATION.sql
```

### **3ë‹¨ê³„: ì½”ë“œ ì ìš© (ì´ë¯¸ ì™„ë£Œ)**
- âœ… TypeScript ì½”ë“œ ë³€ê²½ ì™„ë£Œ
- âœ… ì»´í¬ë„ŒíŠ¸ UI í…ìŠ¤íŠ¸ ë³€ê²½ ì™„ë£Œ
- âœ… íƒ€ì… ì •ì˜ ë³€ê²½ ì™„ë£Œ

### **4ë‹¨ê³„: í…ŒìŠ¤íŠ¸**
1. ë¸Œë¼ìš°ì €ì—ì„œ í•™ìƒ í•™ìŠµ ì‹œì‘
2. ë‹¨ì–´ Skip í…ŒìŠ¤íŠ¸
3. ë‹¤ìŒ íšŒì°¨ì— ì¦‰ì‹œ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸
4. ë¬´í•œ ë¡œë”© ì—†ëŠ”ì§€ í™•ì¸

---

## âš ï¸ **ì£¼ì˜ ì‚¬í•­**

### **1. `completed_date`ì˜ ì—­í•  ë³€ê²½**
- âŒ **Before**: í•„í„°ë§ì— ì‚¬ìš© (`.eq('completed_date', today)`)
- âœ… **After**: ê¸°ë¡ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©

### **2. `next_appear_date` ì‚¬ìš© ê¸ˆì§€**
- âŒ **Before**: ë‚ ì§œ ì €ì¥, ë‚ ì§œ ë¹„êµ
- âœ… **After**: í•­ìƒ `NULL` (ì¦‰ì‹œ ì¬ë“±ì¥)

### **3. "Day" ìš©ì–´ ì‚¬ìš© ê¸ˆì§€**
- âŒ "Day 1", "Day ì™„ë£Œ"
- âœ… "1íšŒì°¨", "íšŒì°¨ ì™„ë£Œ"

---

## ğŸ‰ **ê¸°ëŒ€ íš¨ê³¼**

### **1. ë¬´í•œ ë¡œë”© í•´ê²°**
- Skip ë‹¨ì–´ê°€ ë‚ ì§œ ë•Œë¬¸ì— ì•ˆ ë‚˜íƒ€ë‚˜ëŠ” ë¬¸ì œ í•´ê²°
- ë§ˆì§€ë§‰ ë‹¨ì–´ ë°˜ë³µ ë¬¸ì œ í•´ê²°

### **2. ë…¼ë¦¬ì  ì¼ê´€ì„±**
- "íšŒì°¨" ë‹¨ìœ„ë¡œ í†µì¼
- ë‚ ì§œì™€ ë¬´ê´€í•˜ê²Œ ì§„í–‰

### **3. ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
- Skipí•œ ë‹¨ì–´ ì¦‰ì‹œ ë³µìŠµ
- ì§„í–‰ë„ ì¶”ì  ëª…í™•

---

## ğŸ“Š **í˜„ì¬ ìƒíƒœ**

âœ… **TypeScript ì½”ë“œ**: ì™„ë£Œ  
â³ **SQL ë§ˆì´ê·¸ë ˆì´ì…˜**: ì‹¤í–‰ ëŒ€ê¸° (`PHASE3-FINAL-SESSION-MIGRATION.sql`)  
â³ **í…ŒìŠ¤íŠ¸**: ì‹¤í–‰ ëŒ€ê¸°  

---

## ğŸš€ **ë‹¤ìŒ ë‹¨ê³„**

1. **Supabaseì—ì„œ `PHASE3-FINAL-SESSION-MIGRATION.sql` ì‹¤í–‰**
2. **`VERIFY-SESSION-MIGRATION.sql`ë¡œ ê²€ì¦**
3. **ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸**
4. **Skip ë‹¨ì–´ ì¦‰ì‹œ ì¬ë“±ì¥ í™•ì¸**

---

**ì™„ë£Œ ì‹œê°**: 2025-10-29  
**ë§ˆì´ê·¸ë ˆì´ì…˜ ë²„ì „**: Phase 3 - Final Session Migration

