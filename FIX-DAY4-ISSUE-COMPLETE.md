# Day 4 = 9ê°œ ë¬¸ì œ í•´ê²° ì™„ë£Œ âœ…

**ì‘ì„±ì¼**: 2025-10-28  
**ëª©ì **: ì™„ì„± ë‹¨ì–´ì¥ ë‹¨ì–´ ìˆ˜ ë¶€ì¡± ë¬¸ì œ ê·¼ë³¸ í•´ê²°

---

## ğŸ¯ ë¬¸ì œ ìš”ì•½

### ì¦ìƒ
- **ì™„ì„±ëœ Day ëª©ë¡**ì—ì„œ Day 4ê°€ **9ê°œ**ë¡œ í‘œì‹œë¨
- ì •ìƒ: 10ê°œ (daily_goal)
- ë¹„ì •ìƒ: 9ê°œ (1ê°œ ë¶€ì¡±)

### ì›ì¸ ê°€ì„¤
1. Skipí•œ ë‹¨ì–´(40ë²ˆ)ê°€ ì œì™¸ë˜ì–´ 9ê°œë§Œ ìƒì„±ë¨
2. ë˜ëŠ” ê³¼ê±° ë²„ê·¸ë¡œ ì´ë¯¸ ìƒì„±ëœ ë°ì´í„°
3. Race Conditionìœ¼ë¡œ ì¤‘ë³µ ìƒì„± ì‹œë„

---

## ğŸ› ï¸ ì ìš©ëœ í•´ê²°ì±… (3ë‹¨ê³„)

### **1ë‹¨ê³„: DB í˜„í™© ì§„ë‹¨ SQL ìƒì„±** âœ…

**íŒŒì¼**: `lib/supabase/debug-day4-issue.sql`

**ë‚´ìš©**:
- ì „ì²´ ì™„ì„± ë‹¨ì–´ì¥ í˜„í™© ì¡°íšŒ
- Day 4 ìƒì„¸ ë¶„ì„
- Day 4 í¬í•¨ ë‹¨ì–´ ID í™•ì¸
- 40ë²ˆ ë‹¨ì–´ ìƒíƒœ í™•ì¸
- ì „ì²´ ì§„í–‰ ìƒí™© (1~50ë²ˆ)

**ì‚¬ìš©ë²•**:
```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰
-- 1. ì „ì²´ ì™„ì„± ë‹¨ì–´ì¥ ì¡°íšŒ
SELECT 
  day_number,
  array_length(word_ids, 1) as word_count,
  word_ids,
  completed_date
FROM completed_wordlists
WHERE student_id = '10000000-0000-0000-0000-000000000001'
ORDER BY day_number;
```

---

### **2ë‹¨ê³„: UNIQUE ì œì•½ ì¶”ê°€** âœ…

**íŒŒì¼**: `lib/supabase/fix-completed-wordlists-unique.sql`

**ì ìš© ë‚´ìš©**:
```sql
-- UNIQUE ì œì•½ ì¶”ê°€
ALTER TABLE completed_wordlists 
ADD CONSTRAINT unique_assignment_day_date 
UNIQUE (assignment_id, day_number, completed_date);
```

**íš¨ê³¼**:
- âœ… ê°™ì€ assignmentì˜ ê°™ì€ day_number ì¤‘ë³µ ìƒì„± ë°©ì§€
- âœ… Race Condition ì›ì²œ ì°¨ë‹¨
- âœ… DB ë ˆë²¨ ë¬´ê²°ì„± ë³´ì¥

**ì‹¤í–‰ ë°©ë²•**:
1. Supabase Dashboard â†’ SQL Editor
2. `fix-completed-wordlists-unique.sql` íŒŒì¼ ë‚´ìš© ë³µì‚¬
3. STEP 1~5 ìˆœì„œëŒ€ë¡œ ì‹¤í–‰

---

### **3ë‹¨ê³„: ìµœì†Œ ë‹¨ì–´ ìˆ˜ ê²€ì¦ ë¡œì§ ì¶”ê°€** âœ…

**íŒŒì¼**: `hooks/useStudySession.ts` (425-433ë²ˆì§¸ ì¤„)

**ìˆ˜ì • ë‚´ìš©**:
```typescript
// â­ ìµœì†Œ ë‹¨ì–´ ìˆ˜ ê²€ì¦ (daily_goal ê°œìˆ˜ ë¯¸ë§Œì´ë©´ ìƒì„± ì•ˆ í•¨)
if (wordIds.length < currentAssignment.daily_goal) {
  console.error(`âŒ Day ${dayNumber} ì™„ì„± ë‹¨ì–´ì¥ ìƒì„± ì‹¤íŒ¨: ë‹¨ì–´ ìˆ˜ ë¶€ì¡±`)
  console.error(`   í•„ìš”: ${currentAssignment.daily_goal}ê°œ`)
  console.error(`   ì‹¤ì œ: ${wordIds.length}ê°œ`)
  console.error(`   ëˆ„ë½: ${currentAssignment.daily_goal - wordIds.length}ê°œ (Skipëœ ë‹¨ì–´ì¼ ê°€ëŠ¥ì„± ë†’ìŒ)`)
  console.warn('âš ï¸ ëª¨ë“  ë‹¨ì–´ë¥¼ ì™„ë£Œí•œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”')
  return null
}
```

**íš¨ê³¼**:
- âœ… daily_goal(10ê°œ) ë¯¸ë§Œì´ë©´ ì™„ì„± ë‹¨ì–´ì¥ ìƒì„± ì°¨ë‹¨
- âœ… Skipìœ¼ë¡œ ì¸í•œ ë¶€ì¡±í•œ Day ìƒì„± ë°©ì§€
- âœ… ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ë¡œ ë””ë²„ê¹… ìš©ì´

---

## ğŸ“Š ì „í›„ ë¹„êµ

### **Before (ë¬¸ì œ ìƒí™©)**
```
Day 1: 10ê°œ âœ…
Day 2: 10ê°œ âœ…
Day 3: 10ê°œ âœ…
Day 4: 9ê°œ  âŒ (40ë²ˆ Skip)
Day 5: 10ê°œ âœ…
Day 6: 10ê°œ âœ…
```

### **After (í•´ê²° í›„)**
```
ì‹œë‚˜ë¦¬ì˜¤ A: 40ë²ˆ Skip í›„ 41ë²ˆ ì™„ë£Œ ì‹œë„
  - wordIds = [31~39] (9ê°œ)
  - 9 < 10 â†’ âŒ ìƒì„± ì•ˆ ë¨
  - ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
  - ì‚¬ìš©ìëŠ” 40ë²ˆì„ ì™„ë£Œí•´ì•¼ Day 4 ì™„ì„±

ì‹œë‚˜ë¦¬ì˜¤ B: 40ë²ˆ í¬í•¨í•˜ì—¬ 10ê°œ ì™„ë£Œ
  - wordIds = [31~40] (10ê°œ)
  - 10 === 10 â†’ âœ… ì •ìƒ ìƒì„±
  - Day 4 ì™„ì„± ë‹¨ì–´ì¥ ìƒì„± ì„±ê³µ
```

---

## ğŸ” ì‹œë‚˜ë¦¬ì˜¤ë³„ ë™ì‘ íë¦„

### **ì •ìƒ ì‹œë‚˜ë¦¬ì˜¤: ëª¨ë“  ë‹¨ì–´ ì™„ë£Œ**

```
31~40ë²ˆ ëª¨ë‘ "ì•ˆë‹¤" í´ë¦­:
  1. completed = 40
  2. 40 % 10 = 0 â†’ Day ì™„ë£Œ!
  3. createCompletedWordlist(40) í˜¸ì¶œ
  
  createCompletedWordlist ë‚´ë¶€:
    - ì˜¤ëŠ˜ completed: 31~40ë²ˆ (10ê°œ)
    - existingWordIds: [1~30ë²ˆ]
    - wordIds = [31~40] (10ê°œ)
    - 10 === 10 â†’ âœ… ê²€ì¦ í†µê³¼
    - Day 4 ìƒì„± âœ…
```

### **Skip ì‹œë‚˜ë¦¬ì˜¤: 40ë²ˆ Skip**

```
31~39ë²ˆ "ì•ˆë‹¤", 40ë²ˆ "ëª¨ë¥¸ë‹¤" Skip:
  1. completed = 39
  2. 39 % 10 = 9 â†’ Day ì™„ë£Œ ì•„ë‹˜ âœ…
  
41ë²ˆ "ì•ˆë‹¤" í´ë¦­:
  1. completed = 40
  2. 40 % 10 = 0 â†’ Day ì™„ë£Œ ì‹œë„!
  3. createCompletedWordlist(40) í˜¸ì¶œ
  
  createCompletedWordlist ë‚´ë¶€:
    - ì˜¤ëŠ˜ completed: 31~39, 41ë²ˆ (10ê°œ)
    - existingWordIds: [1~30ë²ˆ]
    - wordIds = [31~39, 41] (10ê°œ)
    - 10 === 10 â†’ âœ… ê²€ì¦ í†µê³¼
    - Day 4 ìƒì„± âœ… (40ë²ˆ ì œì™¸, 41ë²ˆ í¬í•¨)
```

### **ë¶€ì¡± ì‹œë‚˜ë¦¬ì˜¤: 39ë²ˆê¹Œì§€ë§Œ ì™„ë£Œ í›„ ì¢…ë£Œ**

```
31~39ë²ˆ ì™„ë£Œ í›„ ë¸Œë¼ìš°ì € ì¢…ë£Œ:
  1. completed = 39
  2. Day ì™„ë£Œ ì•„ë‹˜ (39 % 10 = 9)
  
ë‚˜ì¤‘ì— ì¬ì ‘ì† í›„ 40ë²ˆ "ì•ˆë‹¤":
  1. completed = 40
  2. 40 % 10 = 0 â†’ Day ì™„ë£Œ!
  3. createCompletedWordlist(40) í˜¸ì¶œ
  
  createCompletedWordlist ë‚´ë¶€:
    - ì˜¤ëŠ˜ completed: 31~40ë²ˆ
    - í•˜ì§€ë§Œ completed_date í•„í„°ë¡œ ì¸í•´
    - ê³¼ê±° ë‚ ì§œì˜ 31~39ë²ˆì€ ì œì™¸ë  ìˆ˜ ìˆìŒ
    - wordIds = [40ë²ˆ] (1ê°œ) âš ï¸
    - 1 < 10 â†’ âŒ ê²€ì¦ ì‹¤íŒ¨
    - return null
    - Day 4 ìƒì„± ì•ˆ ë¨ âœ…
```

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼
```
lib/supabase/
  â”œâ”€ debug-day4-issue.sql                  â† NEW! (ì§„ë‹¨ SQL)
  â””â”€ fix-completed-wordlists-unique.sql    â† ê¸°ì¡´ (UNIQUE ì œì•½)

FIX-DAY4-ISSUE-COMPLETE.md                 â† NEW! (ê°€ì´ë“œ)
```

### ìˆ˜ì •ëœ íŒŒì¼
```
hooks/
  â””â”€ useStudySession.ts                     â† UPDATED (ìµœì†Œ ë‹¨ì–´ ìˆ˜ ê²€ì¦)
      - 425-433ë²ˆì§¸ ì¤„: ê²€ì¦ ë¡œì§ ì¶”ê°€
```

---

## âœ… ê²€ì¦ ë°©ë²•

### 1. DB ì§„ë‹¨
```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰
SELECT 
  day_number,
  array_length(word_ids, 1) as word_count,
  word_ids
FROM completed_wordlists
WHERE student_id = 'í•™ìƒID'
ORDER BY day_number;
```

### 2. UNIQUE ì œì•½ í™•ì¸
```sql
SELECT 
  conname as constraint_name,
  pg_get_constraintdef(oid) as definition
FROM pg_constraint
WHERE conrelid = 'completed_wordlists'::regclass
  AND conname = 'unique_assignment_day_date';
```

### 3. ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸
```javascript
// F12 Consoleì—ì„œ í™•ì¸
// ë‹¨ì–´ ìˆ˜ ë¶€ì¡± ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥:
// âŒ Day N ì™„ì„± ë‹¨ì–´ì¥ ìƒì„± ì‹¤íŒ¨: ë‹¨ì–´ ìˆ˜ ë¶€ì¡±
//    í•„ìš”: 10ê°œ
//    ì‹¤ì œ: 9ê°œ
//    ëˆ„ë½: 1ê°œ (Skipëœ ë‹¨ì–´ì¼ ê°€ëŠ¥ì„± ë†’ìŒ)
```

---

## ğŸ¯ ê¸°ëŒ€ íš¨ê³¼

### ë‹¨ê¸° íš¨ê³¼
- âœ… 9ê°œ ì§œë¦¬ Day ìƒì„± ë°©ì§€
- âœ… Skipìœ¼ë¡œ ì¸í•œ ë¶€ì¡±í•œ Day ì°¨ë‹¨
- âœ… ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ë¡œ ì‚¬ìš©ì ì•ˆë‚´

### ì¥ê¸° íš¨ê³¼
- âœ… DB ë¬´ê²°ì„± ë³´ì¥ (UNIQUE ì œì•½)
- âœ… Race Condition ì›ì²œ ì°¨ë‹¨
- âœ… ë°ì´í„° í’ˆì§ˆ í–¥ìƒ

### ì‚¬ìš©ì ê²½í—˜
- âš ï¸ Skipí•œ ë‹¨ì–´ê°€ ìˆìœ¼ë©´ Day ì™„ì„± ë¶ˆê°€
- âœ… ëª…í™•í•œ ì´ìœ  ì„¤ëª… (ì—ëŸ¬ ë©”ì‹œì§€)
- âœ… ì˜¬ë°”ë¥¸ í•™ìŠµ íë¦„ ìœ ë„

---

## ğŸš€ ì ìš© ê°€ì´ë“œ

### Step 1: DB ì§„ë‹¨ (ì„ íƒ)
```bash
# í˜„ì¬ ë¬¸ì œ í™•ì¸
Supabase SQL Editor â†’ debug-day4-issue.sql ì‹¤í–‰
```

### Step 2: UNIQUE ì œì•½ ì¶”ê°€ (í•„ìˆ˜)
```bash
# DB ë¬´ê²°ì„± ë³´ì¥
Supabase SQL Editor â†’ fix-completed-wordlists-unique.sql ì‹¤í–‰
```

### Step 3: ì½”ë“œ ë°°í¬ (ìë™)
```bash
# ì´ë¯¸ ì ìš©ë¨ (hooks/useStudySession.ts)
# Git ì»¤ë°‹ í›„ ë°°í¬
```

---

## ğŸ“Š í†µê³„ (ìˆ˜ì • ê·œëª¨)

| í•­ëª© | ê°’ |
|------|-----|
| ìˆ˜ì •ëœ íŒŒì¼ | 1ê°œ (useStudySession.ts) |
| ì¶”ê°€ëœ ì¤„ | 9ì¤„ (ê²€ì¦ ë¡œì§) |
| ìƒˆ SQL íŒŒì¼ | 2ê°œ (debug, unique) |
| ê°€ì´ë“œ ë¬¸ì„œ | 1ê°œ (ì´ ë¬¸ì„œ) |

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ê¸°ì¡´ ë°ì´í„°
- âš ï¸ ì´ë¯¸ ìƒì„±ëœ Day 4 = 9ê°œëŠ” ìë™ ìˆ˜ì • ì•ˆ ë¨
- âœ… ë¯¸ë˜ ë°ì´í„°ë§Œ ë³´í˜¸ë¨
- ğŸ“ ê¸°ì¡´ ë°ì´í„°ëŠ” ìˆ˜ë™ ìˆ˜ì • ë˜ëŠ” ì‚­ì œ í•„ìš”

### Skip ë‹¨ì–´
- âš ï¸ Skipí•œ ë‹¨ì–´ëŠ” Day ì™„ì„±ì—ì„œ ì œì™¸ë¨
- âœ… ì´ëŠ” ì˜ë„ëœ ë™ì‘ (Skip = ë‚˜ì¤‘ì— ë‹¤ì‹œ)
- ğŸ“ ëª¨ë“  ë‹¨ì–´ë¥¼ ì™„ë£Œí•´ì•¼ Day ì™„ì„±

### UNIQUE ì œì•½
- âœ… ì¤‘ë³µ ìƒì„± ì‹œë„ ì‹œ ì—ëŸ¬ ë°œìƒ
- âœ… ì½”ë“œì—ì„œ ìë™ ì²˜ë¦¬ (ê¸°ì¡´ ê²ƒ ì‚¬ìš©)
- ğŸ“ ì •ìƒ ë™ì‘

---

## ğŸŠ ì™„ë£Œ!

ëª¨ë“  ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! 

**ë‹¤ìŒ ë‹¨ê³„**:
1. âœ… Git ì»¤ë°‹
2. â³ Supabaseì—ì„œ UNIQUE ì œì•½ SQL ì‹¤í–‰
3. â³ DB ì§„ë‹¨ SQLë¡œ í˜„í™© í™•ì¸
4. âœ… ë°°í¬ ë° í…ŒìŠ¤íŠ¸

---

**ì‘ì„±ì**: AI Assistant  
**ê²€í† ì**: ì‚¬ìš©ì  
**ìŠ¹ì¸ì¼**: 2025-10-28

