# 시험지 출력 기능 사용 가이드

## 📖 개요

학생의 완료된 학습 회차에서 선택적으로 시험지를 생성하고 인쇄할 수 있는 기능입니다.

### 주요 특징
- ✅ 여러 회차 선택 가능
- ✅ 아는 단어 30% 랜덤 추출
- ✅ 모르는 단어 70% 랜덤 추출
- ✅ 시험지 + 답지 자동 생성
- ✅ 양면 인쇄 최적화 (답지 홀수 페이지 시작)
- ✅ A4 용지 기준 레이아웃

---

## 🎯 사용 방법

### 1. 회차 선택
1. 학생 대시보드에서 **학습 기록** 섹션으로 이동
2. 시험지에 포함할 회차의 **체크박스**를 선택
   - 예: 1회차, 2회차, 3회차, 4회차 선택

### 2. 시험지 생성
**상단에 2개의 버튼이 있습니다:**

#### 아는 단어 시험지 출력
- 선택한 회차의 **아는 단어** 수집
- 중복 제거 후 **30% 랜덤 추출**
- 시험지 + 답지 생성

#### 모르는 단어 시험지 출력
- 선택한 회차의 **모르는 단어** 수집
- 중복 제거 후 **70% 랜덤 추출**
- 시험지 + 답지 생성

### 3. 확인 및 인쇄
1. 모달에서 추출된 단어 확인
   - 전체 단어 수
   - 추출 비율 (30% 또는 70%)
   - 최종 시험지 단어 수
2. **"시험지 인쇄"** 버튼 클릭
3. 브라우저 인쇄 미리보기 확인
4. 인쇄 또는 PDF 저장

---

## 📝 출력 형식

### 시험지 (문제지)
```
[제목: 아는 단어 시험지 (4개 회차) / 모르는 단어 시험지 (4개 회차)]

1. apple               16. computer
2. book                17. desk
3. cat                 18. elephant
4. dog                 19. flower
5. ...                 20. ...

(좌우 2단 레이아웃, 영어 단어만)
```

### 답지 (정답지)
```
정답지
─────────────────────────────────

1. apple : 사과          16. computer : 컴퓨터
2. book : 책            17. desk : 책상
3. cat : 고양이          18. elephant : 코끼리
4. dog : 개             19. flower : 꽃
5. ...                  20. ...

(좌우 2단 레이아웃, 영어 + 한글 뜻)
```

---

## 🖨️ 인쇄 설정

### 권장 설정
- **용지**: A4 (210mm × 297mm)
- **방향**: 세로
- **여백**: 2cm (상하좌우)
- **인쇄 모드**: 양면 인쇄 (긴 쪽 기준)

### 양면 인쇄 workflow
```
[시험지]
페이지 1 ─┐
페이지 2 ─┤ 시험지 문제
[빈 페이지] (필요시)

[답지]
페이지 3 ─┐
페이지 4 ─┤ 정답지
페이지 5 ─┤
...       ─┘
```

**답지는 항상 홀수 페이지(3, 5, 7...)에서 시작합니다.**
- 시험지 1~2페이지 → 답지 3페이지부터
- 시험지 3~4페이지 → 답지 5페이지부터
- 이렇게 하면 양면 인쇄 시 시험지 뒷면에 답지가 나오지 않습니다.

---

## 🔄 랜덤 추출

### 재추출 방법
모달을 닫았다가 다시 열면 **새로운 랜덤 단어**가 추출됩니다.

```
1회 시도: apple, book, cat, ...
2회 시도: desk, flower, game, ...  ← 다른 단어들
```

### 추출 비율
- **아는 단어**: 30% (복습용, 적은 비율)
- **모르는 단어**: 70% (연습용, 높은 비율)

### 중복 제거
같은 단어가 여러 회차에 나와도 **한 번만 출력**됩니다.

---

## 💡 활용 팁

### 1. 주간 복습 시험
```
→ 1주일 학습 완료 (1~4회차)
→ 모든 회차 선택
→ "모르는 단어 시험지" 출력
→ 70% 샘플 테스트
```

### 2. 월말 평가
```
→ 1개월 학습 완료 (1~20회차)
→ 모든 회차 선택
→ "아는 단어 시험지" 출력
→ 30% 샘플로 정착도 확인
```

### 3. 특정 범위 집중 학습
```
→ 어려웠던 3~5회차만 선택
→ "모르는 단어 시험지" 출력
→ 집중 복습
```

### 4. 인쇄 vs PDF
- **인쇄**: 학원에서 즉시 테스트 진행
- **PDF 저장**: 학생에게 온라인 전달 (폰으로 확인)

---

## 🚨 주의사항

### 1. 선택 필수
- 최소 **1개 이상의 회차**를 선택해야 버튼이 활성화됩니다.

### 2. 단어 없음
- 선택한 회차에 해당 유형(아는/모르는)의 단어가 없으면:
  ```
  "단어가 없습니다"
  선택한 회차에 아는 단어가 없습니다.
  ```

### 3. 최소 단어 수
- 추출 후 최소 **1개의 단어**는 보장됩니다 (`Math.ceil` 사용)
- 예: 전체 2개 × 30% = 0.6 → **1개** 추출

### 4. 브라우저 호환성
- **Chrome, Edge**: 완벽 지원
- **Firefox**: 페이지 분할 일부 차이 있을 수 있음
- **Safari**: 인쇄 미리보기 제한적

### 5. 모바일
- 모바일에서는 **화면 확인용**으로만 사용 권장
- 실제 인쇄는 **PC에서 진행** 권장

---

## 🔧 기술 세부사항

### 데이터 흐름
```
1. 사용자가 회차 선택 (체크박스)
2. 버튼 클릭 → sessionIds 배열 전달
3. Supabase에서 completed_wordlists 조회
4. word_ids 또는 unknown_word_ids 수집
5. 중복 제거 (Set)
6. Fisher-Yates Shuffle
7. 30% 또는 70% 추출
8. words 테이블에서 word_text, meaning 조회
9. 모달 표시 + 인쇄 콘텐츠 렌더링
```

### 랜덤 알고리즘
**Fisher-Yates Shuffle**을 사용하여 공정한 무작위 추출을 보장합니다.

```typescript
const shuffleArray = <T,>(array: T[]): T[] => {
  const shuffled = [...array]
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]
  }
  return shuffled
}
```

### 인쇄 CSS
```css
@media print {
  /* 일반 UI 숨기기 */
  body * { visibility: hidden !important; }
  
  /* 시험지만 표시 */
  #exam-print-content,
  #exam-print-content * { visibility: visible !important; }
  
  /* 답지 홀수 페이지 시작 */
  .answer-section { page-break-before: always !important; }
  
  /* 시험지 페이지 분할 */
  .exam-section { break-after: left; }
}
```

---

## 📊 예제 시나리오

### 시나리오 1: 1~4회차 모르는 단어 시험
```
회차별 모르는 단어:
- 1회차: 5개
- 2회차: 8개 (중복 2개)
- 3회차: 6개 (중복 1개)
- 4회차: 7개

→ 중복 제거: 5 + 6 + 5 + 7 = 23개
→ 70% 추출: Math.ceil(23 × 0.7) = 17개
→ 시험지: 17문제
```

### 시나리오 2: 1~10회차 아는 단어 시험
```
회차별 아는 단어:
- 총 200개 (중복 제거 후)

→ 30% 추출: Math.ceil(200 × 0.3) = 60개
→ 시험지: 60문제
→ 약 2페이지 시험지 + 3페이지부터 답지
```

---

## 🐛 문제 해결

### 문제: 버튼이 비활성화됨
**원인**: 회차를 선택하지 않음
**해결**: 최소 1개 이상의 체크박스 선택

### 문제: "단어가 없습니다" 표시
**원인**: 선택한 회차에 해당 유형의 단어가 없음
**해결**: 
- 다른 회차 선택
- 다른 타입(아는/모르는) 시도

### 문제: 인쇄 시 빈 페이지만 나옴
**원인**: 브라우저 CSS 지원 문제
**해결**:
- Chrome 또는 Edge 사용 권장
- 페이지 새로고침 (Ctrl + Shift + R)

### 문제: 답지가 홀수 페이지에서 시작 안 함
**원인**: 브라우저의 `break-after: left` 미지원
**영향**: 기능적으로는 문제없음 (모든 내용 출력됨)
**해결**: Chrome/Edge에서 인쇄 권장

---

## 📅 개발 이력

- **2025-10-30**: 기능 완성
  - 8단계 개발 플랜 완료
  - 랜덤 추출 (30%/70%)
  - 시험지 + 답지 출력
  - 양면 인쇄 최적화

---

## 📚 관련 문서

- [EXAM-PRINT-PLAN.md](./EXAM-PRINT-PLAN.md) - 8단계 개발 플랜
- [KNOWN-UNKNOWN-WORDS-MODAL-COMPLETE.md](./KNOWN-UNKNOWN-WORDS-MODAL-COMPLETE.md) - 단어 목록 모달

---

**문의사항이나 개선 제안은 개발팀에 전달해주세요!** 🙏

